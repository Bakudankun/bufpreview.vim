<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>

    <!-- CSS for MarkDown -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css">
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/xcode.min.css">

    <title>Loading...</title>

    <script>
      const closeWindow = () => {
        window.open('about:blank','_self').close()
        document.getElementById('render').innerHTML = '<h1 align="center">Connection closed</h1>'
        document.title = "Connection closed"
      }

      const socket = new WebSocket('ws://localhost:'+location.port+'/ws')
      socket.onerror = function(_) {
        document.getElementById('render').innerHTML = '<h1 align="center">Connection closed</h1>'
        document.title = "Connection closed"
      }
      socket.onclose = function() {
        closeWindow()
      }
      socket.addEventListener('message', function (event) {
        var res = JSON.parse(event.data)
        if (res.bufname != undefined) {
          document.title = res.bufname
        }
        if (res.buf != undefined) {
          document.getElementById('render').innerHTML = res.buf
        }          
        if (res.cursorPos != undefined) {
          console.log(res.cursorPos)
        }
        if (res.connect != undefined && res.connect == "close") {
          closeWindow()
        }
      })

    </script>
    <style>
      .view {
        padding: 10px;
      }
    </style>
  </head>

  <body>
    <div class="view">
      <article class="markdown-body" id="render">
        <h1 align="center">Loading...</h1>
      </article>
    <div>
  </body>
</html>
